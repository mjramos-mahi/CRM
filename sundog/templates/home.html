{% extends "app-base.html" %}
{% load  staticfiles my_filters admin_urls %}
{% block extrahead %}
<link href="{% static "css/plugins/datapicker/datepicker3.css" %}" rel="stylesheet">
<link href="{% static "css/plugins/morris/morris-0.4.3.min.css" %}" rel="stylesheet">
<link href="{% static "css/plugins/dataTables/dataTables.bootstrap.css" %}" rel="stylesheet">
<link href="{% static "css/plugins/dataTables/dataTables.responsive.css" %}" rel="stylesheet">
{% endblock extrahead %}
{% block content %}
    <!-- PATH GUIDE -->
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
            <h2>Home</h2>
            <ol class="breadcrumb">
                <li class="active">
                    <strong>Home</strong>
                </li>
            </ol>
        </div>
        <div class="col-lg-2">

        </div>
    </div>
    <!-- PAGE CONTENT -->
    <div class="wrapper wrapper-content animated fadeInRight">
        <div id="morris-area-chart-container" class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-content text-center p-md">
                        <div id="morris-area-chart" style="height: 250px;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Files ({% if page_obj.object_list %} {{ paginator.count }} {% else %} 0 {% endif %})</h5>
                        <div class="ibox-tools">
                            {% if perms.sundog.add_myfile %}
                            <a href="{% url 'file_add' %}" class="btn btn-primary btn-xs"><i class="fa fa-plus"></i> Create new file</a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div class="row m-b-lg">
                            <form id="search-form" action="{% url 'home_search' %}" method="get">
                                <input type="hidden" name="page" value="{{ page_obj.number }}"/>
                                {{ form.sort_column }} {{ form.sort_asc }}
                                <div class="col-sm-3 m-b-xs">
                                    {{ form.status }}
                                </div>
                                <div class="col-sm-2 m-b-xs">
                                    {% if perms.sundog.view_all_files %}
                                    <div data-toggle="buttons" class="btn-group">
                                        <label for="id_radio_field_0" class="btn btn-sm btn-white"> <input type="radio" id="id_radio_field_0" name="radio_field" value="0">All Files</label>
                                        <label for="id_radio_field_1" class="btn btn-sm btn-white"> <input type="radio" id="id_radio_field_1" name="radio_field" value="1">Participant Only</label>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="col-sm-3 form-group" id="created_range">
                                    <div class="input-daterange input-group" id="datepicker">
                                        {{ form.created_start }}
                                        <span class="input-group-addon">to</span>
                                        {{ form.created_end }}
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="input-group">{{ form.q }} <span class="input-group-btn">
                                        <button type="button" class="btn btn-sm btn-primary" onclick="updateSearch()"> Go!</button> </span></div>
                                </div>
                            </form>
                        </div>

                        <div class="project-list">
                            <table id="dataTable" class="table table-hover dataTable no-footer">
                                <thead>
                                <tr>
                                    <th id="th_Id" class="sorting">Id</th>
                                    <th id="th_File" class="sorting">File</th>
                                    <th id="th_Current_Status" class="sorting">Current Status</th>
                                    <th id="th_Priority" class="sorting">Priority</th>
                                    <th id="th_Completion" class="sorting">Completion</th>
                                    <th>Tags </th>
                                    <th class="text-center">Actions</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% if page_obj.object_list %}
                                    {% for result in page_obj.object_list %}
                                    <tr>
                                        <td>{{ result.pk }}</td>
                                        <td class="project-title">
                                            <a href="{% url 'file_detail' result.pk %}">{{ result.description|title }}</a>
                                            <br/>
                                            <small>Created on: {{ result.created_time|formatDatetimeTz:user.id }}</small>
                                        </td>
                                        {{ result.rendered|safe }}
                                        <td class="project-actions">
                                            <a href="{% url 'file_detail' result.pk %}" class="btn btn-white btn-sm"><i class="fa fa-folder"></i> View </a>
                                            {% if perms.sundog.change_myfile %}<a href="{% url 'file_edit' result.pk %}" class="btn btn-white btn-sm"><i class="fa fa-pencil"></i> Edit </a>{% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="7"><strong>No data to display!</strong></td>
                                    </tr>
                                {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="ibox-footer">
                        {% if page_obj.object_list %}
                        <div class="text-center">
                            <div class="btn-group">
                                <button class="btn btn-white prev-page" type="button" {% if page_obj.number == 1 %}
                                disabled="disabled"
                                {% endif %} ><i class="fa fa-chevron-left"></i></button>
                               {% for number in paginator|paginatorRange:page_obj.number %}
                                   {% if number == page_obj.number %}
                                    <button class="btn btn-white active">{{ number }}</button>
                                   {% else %}
                                    <button class="btn btn-white move-page">{{ number }}</button>
                                   {% endif %}
                                {% endfor %}
                                <button class="btn btn-white next-page" type="button" {% if page_obj.number == paginator.num_pages %}
                                        disabled="disabled"
                                {% endif %}><i class="fa fa-chevron-right"></i> </button>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="{% static "js/plugins/datapicker/bootstrap-datepicker.js" %}"></script>
    <script src="{% static "js/plugins/morris/raphael-2.1.0.min.js" %}"></script>
    <script src="{% static "js/plugins/morris/morris.js" %}"></script>
    <script type="text/javascript" >
        var chart_data = {{chart_data|jsonify}};
        var chart_status_names = {{chart_status_names|jsonify}};
    </script>
    <script src="{% static "js/home.js" %}"></script>
{% endblock %}